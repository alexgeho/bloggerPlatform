openapi: 3.0.0

info:
  title: Blogger Platform API
  version: 1.0.0
  description: |
    Blogger platform API: blogs, posts, comments, users, authentication, likes, device sessions.

tags:
  - name: Blogs
    description: Blogs management
  - name: Posts
    description: Posts management
  - name: Users
    description: Users management
  - name: Comments
    description: Comments management
  - name: Auth
    description: Registration, login, JWT, password recovery.
  - name: Security Devices
    description: Device sessions (refresh token).
  - name: Testing
    description: Database cleanup for tests.

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Access token in the Authorization header
  schemas:
    Pagination:
      type: object
      properties:
        pagesCount: { type: integer }
        page: { type: integer }
        pageSize: { type: integer }
        totalCount: { type: integer }
    Blog:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        websiteUrl: { type: string }
        createdAt: { type: string }
        isMembership: { type: boolean }
    Post:
      type: object
      properties:
        id: { type: string }
        title: { type: string }
        shortDescription: { type: string }
        content: { type: string }
        blogId: { type: string }
        blogName: { type: string, nullable: true }
        createdAt: { type: string }
        extendedLikesInfo:
          type: object
          properties:
            likesCount: { type: integer }
            dislikesCount: { type: integer }
            myStatus: { type: string, enum: [None, Like, Dislike] }
            newestLikes:
              type: array
              items:
                type: object
                properties:
                  addedAt: { type: string }
                  userId: { type: string }
                  login: { type: string }
    User:
      type: object
      properties:
        id: { type: string }
        login: { type: string }
        email: { type: string }
        createdAt: { type: string }
    Comment:
      type: object
      properties:
        id: { type: string }
        content: { type: string }
        commentatorInfo:
          type: object
          properties:
            userId: { type: string }
            userLogin: { type: string }
        createdAt: { type: string }
        likesInfo:
          type: object
          properties:
            likesCount: { type: integer }
            dislikesCount: { type: integer }
            myStatus: { type: string, enum: [None, Like, Dislike] }
    DeviceSession:
      type: object
      properties:
        deviceId: { type: string }
        ip: { type: string }
        userAgent: { type: string }
        lastActiveDate: { type: string }
    Error:
      type: object
      properties:
        message: { type: string }
        errorsMessages:
          type: array
          items:
            type: object
            properties:
              message: { type: string }
              field: { type: string }

paths:
  # ==================== BLOGS ====================
  /blogs:
    get:
      summary: Get list of blogs
      tags: [Blogs]
      parameters:
        - name: pageNumber
          in: query
          schema: { type: integer, default: 1 }
        - name: pageSize
          in: query
          schema: { type: integer, default: 10 }
        - name: sortBy
          in: query
          schema: { type: string, enum: [createdAt, name, description, websiteUrl], default: createdAt }
        - name: sortDirection
          in: query
          schema: { type: string, enum: [asc, desc], default: desc }
        - name: searchNameTerm
          in: query
          description: Search by blog name
          schema: { type: string }
      responses:
        '200':
          description: Paginated list of blogs.
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      items:
                        type: array
                        items: { $ref: '#/components/schemas/Blog' }
    post:
      summary: Create blog
      tags: [Blogs]
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, description, websiteUrl]
              properties:
                name: { type: string, maxLength: 15 }
                description: { type: string, maxLength: 500 }
                websiteUrl: { type: string, format: uri, maxLength: 100 }
      responses:
        '201':
          description: Blog created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Blog' }
        '400':
          description: Validation error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
        '401':
          description: Unauthorized

  /blogs/{id}:
    get:
      summary: Get blog by id
      tags: [Blogs]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Blog found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Blog' }
        '404':
          description: Blog not found
    put:
      summary: Update blog
      tags: [Blogs]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, description, websiteUrl]
              properties:
                name: { type: string, maxLength: 15 }
                description: { type: string, maxLength: 500 }
                websiteUrl: { type: string, format: uri, maxLength: 100 }
      responses:
        '204':
          description: Updated successfully
        '400':
          description: Validation error
        '401':
          description: Unauthorized
        '404':
          description: Blog not found
    delete:
      summary: Delete blog
      tags: [Blogs]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '204':
          description: Deleted successfully
        '401':
          description: Unauthorized
        '404':
          description: Blog not found

  /blogs/{blogId}/posts:
    get:
      summary: Get blog posts
      tags: [Blogs]
      parameters:
        - name: blogId
          in: path
          required: true
          schema: { type: string }
        - name: pageNumber
          in: query
          schema: { type: integer, default: 1 }
        - name: pageSize
          in: query
          schema: { type: integer, default: 10 }
        - name: sortBy
          in: query
          schema: { type: string, enum: [createdAt, title], default: createdAt }
        - name: sortDirection
          in: query
          schema: { type: string, enum: [asc, desc], default: desc }
      responses:
        '200':
          description: List of blog posts
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      items:
                        type: array
                        items: { $ref: '#/components/schemas/Post' }
        '404':
          description: Blog not found
    post:
      summary: Create post for blog
      tags: [Blogs]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: blogId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, shortDescription, content]
              properties:
                title: { type: string, maxLength: 30 }
                shortDescription: { type: string, maxLength: 100 }
                content: { type: string, maxLength: 1000 }
      responses:
        '201':
          description: Post created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '400':
          description: Validation error
        '401':
          description: Unauthorized
        '404':
          description: Blog not found

  # ==================== POSTS ====================
  /posts:
    get:
      summary: Get list of posts
      tags: [Posts]
      parameters:
        - name: pageNumber
          in: query
          schema: { type: integer, default: 1 }
        - name: pageSize
          in: query
          schema: { type: integer, default: 10 }
        - name: sortBy
          in: query
          schema: { type: string, enum: [createdAt, title], default: createdAt }
        - name: sortDirection
          in: query
          schema: { type: string, enum: [asc, desc], default: desc }
        - name: searchTitleTerm
          in: query
          schema: { type: string }
      responses:
        '200':
          description: Paginated list of posts
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      items:
                        type: array
                        items: { $ref: '#/components/schemas/Post' }
    post:
      summary: Create post
      tags: [Posts]
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, shortDescription, content, blogId]
              properties:
                title: { type: string, maxLength: 30 }
                shortDescription: { type: string, maxLength: 100 }
                content: { type: string, maxLength: 1000 }
                blogId: { type: string }
      responses:
        '201':
          description: Post created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '400':
          description: Validation error
        '401':
          description: Unauthorized
        '404':
          description: Blog not found

  /posts/{id}:
    get:
      summary: Get post by id
      tags: [Posts]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Post found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '404':
          description: Post not found
    put:
      summary: Update post
      tags: [Posts]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, shortDescription, content, blogId]
              properties:
                title: { type: string, maxLength: 30 }
                shortDescription: { type: string, maxLength: 100 }
                content: { type: string, maxLength: 1000 }
                blogId: { type: string }
      responses:
        '204':
          description: Updated successfully
        '400':
          description: Validation error
        '401':
          description: Unauthorized
        '404':
          description: Post not found
    delete:
      summary: Delete post
      tags: [Posts]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '204':
          description: Deleted successfully
        '401':
          description: Unauthorized
        '404':
          description: Post not found

  /posts/{id}/comments:
    get:
      summary: Get post comments
      tags: [Posts]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
        - name: pageNumber
          in: query
          schema: { type: integer, default: 1 }
        - name: pageSize
          in: query
          schema: { type: integer, default: 10 }
        - name: sortBy
          in: query
          schema: { type: string, default: createdAt }
        - name: sortDirection
          in: query
          schema: { type: string, enum: [asc, desc], default: desc }
      responses:
        '200':
          description: List of comments
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      items:
                        type: array
                        items: { $ref: '#/components/schemas/Comment' }
        '404':
          description: Post not found
    post:
      summary: Create comment for post
      tags: [Posts]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content: { type: string, minLength: 20, maxLength: 300 }
      responses:
        '201':
          description: Comment created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Comment' }
        '400':
          description: Validation error
        '401':
          description: Unauthorized
        '404':
          description: Post not found

  /posts/{id}/like-status:
    put:
      summary: Set post like/dislike status
      tags: [Posts]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [likeStatus]
              properties:
                likeStatus: { type: string, enum: [None, Like, Dislike] }
      responses:
        '204':
          description: Status updated
        '400':
          description: Validation error
        '401':
          description: Unauthorized
        '404':
          description: Post not found

  # ==================== USERS ====================
  /users:
    get:
      summary: Get list of users
      tags: [Users]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: pageNumber
          in: query
          schema: { type: integer, default: 1 }
        - name: pageSize
          in: query
          schema: { type: integer, default: 10 }
        - name: sortBy
          in: query
          schema: { type: string, enum: [createdAt, login, email], default: createdAt }
        - name: sortDirection
          in: query
          schema: { type: string, enum: [asc, desc], default: desc }
        - name: searchLoginTerm
          in: query
          schema: { type: string }
      responses:
        '200':
          description: Paginated list of users
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      items:
                        type: array
                        items: { $ref: '#/components/schemas/User' }
        '401':
          description: Unauthorized
    post:
      summary: Create user (admin only)
      tags: [Users]
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [login, email, password]
              properties:
                login: { type: string, minLength: 3, maxLength: 10 }
                email: { type: string, format: email }
                password: { type: string, minLength: 6 }
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/User' }
        '400':
          description: Validation error
        '401':
          description: Unauthorized

  /users/{id}:
    delete:
      summary: Delete user
      tags: [Users]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '204':
          description: Deleted successfully
        '401':
          description: Unauthorized
        '404':
          description: User not found

  # ==================== COMMENTS ====================
  /comments:
    get:
      summary: Get list of comments
      tags: [Comments]
      parameters:
        - name: pageNumber
          in: query
          schema: { type: integer, default: 1 }
        - name: pageSize
          in: query
          schema: { type: integer, default: 10 }
        - name: sortBy
          in: query
          schema: { type: string, enum: [createdAt], default: createdAt }
        - name: sortDirection
          in: query
          schema: { type: string, enum: [asc, desc], default: desc }
      responses:
        '200':
          description: Paginated list of comments
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Pagination'
                  - type: object
                    properties:
                      items:
                        type: array
                        items: { $ref: '#/components/schemas/Comment' }

  /comments/{id}:
    get:
      summary: Get comment by id
      tags: [Comments]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Comment found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Comment' }
        '404':
          description: Comment not found
    put:
      summary: Update comment
      tags: [Comments]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content: { type: string, minLength: 20, maxLength: 300 }
      responses:
        '204':
          description: Updated successfully
        '400':
          description: Validation error
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (not your comment)
        '404':
          description: Comment not found
    delete:
      summary: Delete comment
      tags: [Comments]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '204':
          description: Deleted successfully
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (not your comment)
        '404':
          description: Comment not found

  /comments/{id}/like-status:
    put:
      summary: Set comment like/dislike status
      tags: [Comments]
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [likeStatus]
              properties:
                likeStatus: { type: string, enum: [None, Like, Dislike] }
      responses:
        '204':
          description: Status updated
        '400':
          description: Validation error
        '401':
          description: Unauthorized
        '404':
          description: Comment not found

  # ==================== AUTH ====================
  /auth/registration:
    post:
      summary: Registration
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [login, email, password]
              properties:
                login: { type: string, minLength: 3, maxLength: 10 }
                email: { type: string, format: email }
                password: { type: string, minLength: 6 }
      responses:
        '204':
          description: Confirmation email sent
        '400':
          description: Validation error or login/email already taken

  /auth/registration-confirmation:
    post:
      summary: Confirm registration via code
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code]
              properties:
                code: { type: string }
      responses:
        '204':
          description: Email confirmed
        '400':
          description: Invalid or expired code

  /auth/registration-email-resending:
    post:
      summary: Resend confirmation code
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email: { type: string, format: email }
      responses:
        '204':
          description: Email sent
        '400':
          description: Validation error or email already confirmed

  /auth/login:
    post:
      summary: Login
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [loginOrEmail, password]
              properties:
                loginOrEmail: { type: string }
                password: { type: string }
      responses:
        '200':
          description: Success (accessToken in body, refreshToken in cookie)
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken: { type: string }
        '401':
          description: Invalid login or password

  /auth/refresh-token:
    post:
      summary: Refresh token pair
      tags: [Auth]
      description: Refresh token must be passed in cookies
      responses:
        '200':
          description: New token pair generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken: { type: string }
        '401':
          description: Invalid refresh token

  /auth/logout:
    post:
      summary: Logout
      tags: [Auth]
      description: Invalidate refresh token (cookie)
      responses:
        '204':
          description: Successfully logged out
        '401':
          description: Unauthorized

  /auth/me:
    get:
      summary: Get current user info
      tags: [Auth]
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Current user data
          content:
            application/json:
              schema:
                type: object
                properties:
                  email: { type: string }
                  login: { type: string }
                  userId: { type: string }
        '401':
          description: Unauthorized

  /auth/password-recovery:
    post:
      summary: Request password recovery
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email: { type: string, format: email }
      responses:
        '204':
          description: Recovery email with code sent
        '400':
          description: Validation error

  /auth/new-password:
    post:
      summary: Set new password via recovery code
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [newPassword, recoveryCode]
              properties:
                newPassword: { type: string, minLength: 6 }
                recoveryCode: { type: string }
      responses:
        '204':
          description: Password updated
        '400':
          description: Invalid or expired code

  # ==================== SECURITY DEVICES ====================
  /security/devices:
    get:
      summary: Get active sessions (devices)
      tags: [Security Devices]
      security: [{ bearerAuth: [] }]
      description: Refresh token in cookie. Returns all sessions for the current user.
      responses:
        '200':
          description: List of active devices
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/DeviceSession' }
        '401':
          description: Unauthorized
    delete:
      summary: Terminate all other sessions
      tags: [Security Devices]
      description: Deletes all device sessions except the current one (the one that sent the refresh token).
      responses:
        '204':
          description: All other sessions terminated
        '401':
          description: Unauthorized

  /security/devices/{id}:
    delete:
      summary: Terminate session by device id
      tags: [Security Devices]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '204':
          description: Session terminated
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (not your session)
        '404':
          description: Device not found

  # ==================== TESTING ====================
  /testing/all-data:
    delete:
      summary: Delete all data
      tags: [Testing]
      description: Clears all database collections. For testing and development purposes only.
      responses:
        '204':
          description: All data deleted